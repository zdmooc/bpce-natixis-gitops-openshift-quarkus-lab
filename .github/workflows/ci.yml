name: ci

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  backend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: apps/backend
    steps:
      - uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "17"

      - name: Test
        run: mvn -q test

      - name: Package
        run: mvn -q package -DskipTests

      # Image build/push is intentionally a template.
      # Add registry secrets and uncomment to push.
      #
      # - name: Login to registry
      #   run: echo "${{ secrets.REGISTRY_PASSWORD }}" | docker login "${{ secrets.REGISTRY }}" -u "${{ secrets.REGISTRY_USER }}" --password-stdin
      #
      # - name: Build image
      #   run: docker build -f src/main/docker/Dockerfile.jvm -t "${{ secrets.REGISTRY }}/container-tools-api:${{ github.sha }}" .
      #
      # - name: Push image
      #   run: docker push "${{ secrets.REGISTRY }}/container-tools-api:${{ github.sha }}"
